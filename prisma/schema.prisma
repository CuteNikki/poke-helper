generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Guild {
  guildId String @id

  // Configuration
  counting Counting? @relation("GuildCounting")

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Counting {
  id      Int    @id @default(autoincrement())
  guildId String @unique
  Guild   Guild  @relation("GuildCounting", fields: [guildId], references: [guildId])

  // Configuration
  resetOnFail Boolean @default(false)
  channelId   String

  // State
  lastNumber          Int       @default(0) @map("currentNumber")
  lastNumberAt        DateTime? @map("currentNumberAt")
  lastNumberMessageId String?   @map("currentNumberMessageId")
  lastNumberByUserId  String?   @map("currentNumberByUserId")

  // History
  highestNumber          Int       @default(0)
  highestNumberAt        DateTime?
  highestNumberByUserId  String?
  highestNumberMessageId String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexes
  @@index([channelId])
}
